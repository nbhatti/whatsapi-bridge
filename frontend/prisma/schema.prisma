generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(cuid())
  email        String        @unique
  passwordHash String
  role         String        @default("user")
  createdAt    DateTime      @default(now())
  activityLogs ActivityLog[]
  devices      Device[]
  sessions     Session[]

  @@map("users")
}

model Session {
  id           String   @id @default(cuid())
  userId       String
  jwtId        String   @unique
  refreshToken String
  expiresAt    DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model Device {
  id          String       @id @default(cuid())
  userId      String
  name        String
  waDeviceId  String       @unique
  status      String       @default("inactive")
  createdAt   DateTime     @default(now())
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  messageLogs MessageLog[]

  @@map("devices")
}

model MessageLog {
  id        String   @id @default(cuid())
  deviceId  String
  direction String
  type      String
  to        String?
  body      String?
  timestamp DateTime @default(now())
  device    Device   @relation(fields: [deviceId], references: [id], onDelete: Cascade)

  @@map("message_logs")
}

model ActivityLog {
  id        String   @id @default(cuid())
  userId    String
  action    String
  meta      Json?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("activity_logs")
}
